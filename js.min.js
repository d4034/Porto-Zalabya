const firebaseConfig={apiKey:"AIzaSyBEBHdyxap8fX8HPu9BSxb6wYTf5jG8u7g",authDomain:"elsher.firebaseapp.com",projectId:"elsher",storageBucket:"elsher.firebasestorage.app",messagingSenderId:"378900396521",appId:"1:378900396521:web:1335295e15598a412f7378"};firebase.initializeApp(firebaseConfig);const db=firebase.firestore();db.settings({cacheSizeBytes:firebase.firestore.CACHE_SIZE_UNLIMITED});db.enablePersistence().catch((function(err){if(err.code=="failed-precondition"){console.error("Multiple tabs open, persistence can only be enabled in one tab at a time.")}else if(err.code=="unimplemented"){console.error("The current browser does not support persistence.")}}));console.log=function(){};console.warn=function(){};console.error=function(error){const sanitizedError={message:error.message,timestamp:(new Date).toISOString(),url:window.location.pathname};db.collection("errors").add(sanitizedError)};function sanitizeInput(input){if(typeof input!=="string")return input;return input.replace(/[<>]/g,"").trim()}function validateNumber(num){return!isNaN(parseFloat(num))&&isFinite(num)&&num>0}function addToCart(productId,name,price){try{productId=sanitizeInput(productId);name=sanitizeInput(name);if(!validateNumber(price)){throw new Error("ÿ≥ÿπÿ± ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠")}db.collection("products").doc(productId).get().then((doc=>{if(!doc.exists){throw new Error("ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ")}const product=doc.data();if(product.price!==price||product.name!==name){throw new Error("ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ŸÖÿ™ÿ∑ÿßÿ®ŸÇÿ©")}const existingItem=cart.find((item=>item.id===productId));if(existingItem){existingItem.quantity+=1}else{cart.push({id:productId,name:name,price:price,quantity:1})}updateCartBadge();showNotification("ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©","success")})).catch((error=>{console.error(error);showNotification("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨","error")}))}catch(error){console.error(error);showNotification("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨","error")}}document.getElementById("order-form").addEventListener("submit",(async function(e){e.preventDefault();try{const name=sanitizeInput(document.getElementById("customer-name").value);const phone=sanitizeInput(document.getElementById("customer-phone").value);const address=sanitizeInput(document.getElementById("customer-address").value);if(!phone.match(/^[0-9+\s-]{10,}$/)){throw new Error("ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠")}if(cart.length===0){throw new Error("ÿßŸÑÿ≥ŸÑÿ© ŸÅÿßÿ±ÿ∫ÿ©")}let totalPrice=0;for(const item of cart){if(!validateNumber(item.price)||!validateNumber(item.quantity)){throw new Error("ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ÿ©")}totalPrice+=item.price*item.quantity}const orderCode=generateSecureOrderCode();const orderData={orderCode:orderCode,customerName:name,customerPhone:phone,customerAddress:address,items:cart.map((item=>({id:item.id,name:item.name,price:item.price,quantity:item.quantity}))),totalPrice:totalPrice,status:"pending",createdAt:firebase.firestore.FieldValue.serverTimestamp(),userAgent:window.navigator.userAgent,orderSource:"web"};await db.collection("orders").add(orderData);const message=generateOrderMessage(orderData);sendWhatsAppMessage(message);cart=[];updateCartBadge();showNotification("ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ®ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠!","success");closeCart()}catch(error){console.error(error);showNotification(error.message||"ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®","error")}}));function generateSecureOrderCode(){const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";const length=8;let code="";const array=new Uint8Array(length);crypto.getRandomValues(array);for(let i=0;i<length;i++){code+=chars[array[i]%chars.length]}return code}function generateOrderMessage(orderData){let message=`üåü ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ #${orderData.orderCode}\n`;message+=`------------------\n`;message+=`ÿßŸÑÿßÿ≥ŸÖ: ${orderData.customerName}\n`;message+=`ÿßŸÑŸáÿßÿ™ŸÅ: ${orderData.customerPhone}\n`;message+=`ÿßŸÑÿπŸÜŸàÿßŸÜ: ${orderData.customerAddress}\n\n`;message+=`ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™:\n`;orderData.items.forEach((item=>{const itemTotal=item.price*item.quantity;message+=`${item.name}: ${item.quantity} √ó ${item.price} = ${itemTotal} ÿ¨ŸÜŸäŸá\n`}));message+=`\nÿßŸÑŸÖÿ¨ŸÖŸàÿπ: ${orderData.totalPrice} ÿ¨ŸÜŸäŸá`;return message}function sendWhatsAppMessage(message){const phoneNumber="201556773660";const encodedMessage=encodeURIComponent(message);const url=`https://api.whatsapp.com/send?phone=${phoneNumber}&text=${encodedMessage}`;const link=document.createElement("a");link.href=url;link.style.display="none";document.body.appendChild(link);link.click();document.body.removeChild(link)}let cart=[];let products=[];let currentCategory="all";let selectedProduct=null;async function loadProducts(){try{const snapshot=await db.collection("products").get();products=[];snapshot.forEach((doc=>{products.push({id:doc.id,...doc.data()})}));displayProducts()}catch(error){console.error("Error loading products:",error);showNotification("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™","error")}}function displayProducts(productsToDisplay=products){const menuSection=document.getElementById("menu");menuSection.innerHTML="";const filteredProducts=currentCategory==="all"?productsToDisplay:productsToDisplay.filter((product=>product.category===currentCategory));filteredProducts.forEach((product=>{const productCard=document.createElement("div");productCard.className="product-card";productCard.innerHTML=`\n            <img src="${product.image}" alt="${product.name}" class="product-image">\n            <div class="product-info">\n                <h3 class="product-title">${product.name}</h3>\n                <p class="product-price">${product.price} ÿ¨ŸÜŸäŸá</p>\n                <button onclick="showPriceModal('${product.id}')" class="add-to-cart-btn">\n                    <i class="fas fa-cart-plus"></i>\n                    ÿ£ÿ∂ŸÅ ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©\n                </button>\n            </div>\n        `;menuSection.appendChild(productCard)}))}function changeCategory(category){currentCategory=category;document.querySelectorAll(".category-btn").forEach((btn=>{btn.classList.remove("active")}));document.querySelector(`[data-category="${category}"]`).classList.add("active");displayProducts()}function showPriceModal(productId){selectedProduct=products.find((p=>p.id===productId));if(!selectedProduct)return;const modal=document.getElementById("price-modal");const nameElement=document.getElementById("selected-product-name");const priceElement=document.getElementById("selected-product-price");const priceInput=document.getElementById("price-input");nameElement.textContent=selectedProduct.name;priceElement.textContent=selectedProduct.price+" ÿ¨ŸÜŸäŸá";priceInput.value="";updateQuantityPreview();modal.style.display="block"}function closePriceModal(){document.getElementById("price-modal").style.display="none";selectedProduct=null}function updateQuantityPreview(){const priceInput=document.getElementById("price-input");const quantityPreview=document.getElementById("quantity-preview");const totalPrice=parseFloat(priceInput.value)||0;if(selectedProduct&&totalPrice>0){const kilos=totalPrice/selectedProduct.price;quantityPreview.textContent=kilos.toFixed(2)}else{quantityPreview.textContent="0"}}function confirmPrice(){const priceInput=document.getElementById("price-input");const totalPrice=parseFloat(priceInput.value);if(!selectedProduct||!totalPrice||totalPrice<=0){showNotification("ŸÑÿßÿ≤ŸÖ ÿ™ŸÉÿ™ÿ® ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÑŸä ÿπÿßŸäÿ≤ ÿ™ÿ¥ÿ™ÿ±Ÿä ÿ®ŸäŸá","error");return}const kilos=totalPrice/selectedProduct.price;const existingItem=cart.find((item=>item.id===selectedProduct.id));if(existingItem){existingItem.quantity+=kilos}else{cart.push({id:selectedProduct.id,name:selectedProduct.name,price:selectedProduct.price,quantity:kilos})}updateCartBadge();showNotification(`ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ${kilos.toFixed(2)} ŸÖŸÜ ${selectedProduct.name} ŸÑŸÑÿ≥ŸÑÿ©`,"success");closePriceModal()}function addToCart(productId){const product=products.find((p=>p.id===productId));if(!product)return;const existingItem=cart.find((item=>item.id===productId));if(existingItem){existingItem.quantity+=1}else{cart.push({id:product.id,name:product.name,price:product.price,quantity:1})}updateCartBadge();showNotification("ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©","success")}function updateCartBadge(){const badge=document.getElementById("cart-badge");if(badge){const totalItems=cart.reduce(((sum,item)=>sum+item.quantity),0);badge.textContent=totalItems}}function openCart(){const modal=document.getElementById("cart-modal");const cartItems=document.getElementById("cart-items");const total=document.getElementById("total");cartItems.innerHTML="";let totalPrice=0;cart.forEach((item=>{const itemTotal=item.price*item.quantity;totalPrice+=itemTotal;const li=document.createElement("li");li.className="cart-item";li.innerHTML=`\n            <div>\n                <h4>${item.name}</h4>\n                <p>${item.price} ÿ¨ŸÜŸäŸá √ó ${item.quantity.toFixed(2)}</p>\n            </div>\n            <div>\n                <button onclick="updateQuantity('${item.id}', ${item.quantity-1})">-</button>\n                <span>${item.quantity.toFixed(2)}</span>\n                <button onclick="updateQuantity('${item.id}', ${item.quantity+1})">+</button>\n                <button onclick="removeFromCart('${item.id}')" class="remove-btn">\n                    <i class="fas fa-trash"></i>\n                </button>\n            </div>\n        `;cartItems.appendChild(li)}));total.textContent=totalPrice.toFixed(2);modal.style.display="block"}function closeCart(){document.getElementById("cart-modal").style.display="none"}function updateQuantity(productId,newQuantity){if(newQuantity<=0){removeFromCart(productId);return}const item=cart.find((item=>item.id===productId));if(item){item.quantity=newQuantity;updateCartBadge();openCart()}}function removeFromCart(productId){cart=cart.filter((item=>item.id!==productId));updateCartBadge();openCart()}function generateVerificationCode(){const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let code="";for(let i=0;i<6;i++){code+=chars.charAt(Math.floor(Math.random()*chars.length))}return code}document.getElementById("order-form").addEventListener("submit",(function(e){e.preventDefault();const name=document.getElementById("customer-name").value;const phone=document.getElementById("customer-phone").value;const address=document.getElementById("customer-address").value;const orderCode=generateVerificationCode();const verificationCode=generateVerificationCode();let message=`üåü ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ ŸÖŸÜ ŸÖŸàŸÇÿπ ÿ®ÿ±ÿ™Ÿà ÿ≤ŸÑÿßÿ®Ÿäÿ© üåü\n`;message+=`ŸÉŸàÿØ ÿßŸÑÿ∑ŸÑÿ®: #${orderCode}\n`;message+=`ÿ±ŸÖÿ≤ ÿßŸÑÿ™ÿ≠ŸÇŸÇ: ${verificationCode}\n`;message+=`------------------\n\n`;message+=`ÿßŸÑÿßÿ≥ŸÖ: ${name}\n`;message+=`ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ: ${phone}\n`;message+=`ÿßŸÑÿπŸÜŸàÿßŸÜ: ${address}\n\n`;message+=`ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™:\n`;let totalPrice=0;cart.forEach((item=>{const itemTotal=item.price*item.quantity;totalPrice+=itemTotal;message+=`${item.name}: ${item.quantity.toFixed(2)} √ó ${item.price} ÿ¨ŸÜŸäŸá = ${itemTotal.toFixed(2)} ÿ¨ŸÜŸäŸá\n`}));message+=`\nÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÉŸÑŸä: ${totalPrice.toFixed(2)} ÿ¨ŸÜŸäŸá`;message+=`\n\n------------------`;message+=`\nÿ™ŸÖ ÿßŸÑÿ∑ŸÑÿ® ŸÖŸÜ ŸÖŸàŸÇÿπ ÿ®ÿ±ÿ™Ÿà ÿ≤ŸÑÿßÿ®Ÿäÿ©`;message+=`\nwww.portozalabya.com`;db.collection("orders").add({orderCode:orderCode,verificationCode:verificationCode,customerName:name,customerPhone:phone,customerAddress:address,items:cart,totalPrice:totalPrice,status:"pending",createdAt:firebase.firestore.FieldValue.serverTimestamp()}).then((()=>{const link=document.createElement("a");link.href=`https://api.whatsapp.com/send?phone=201273580725&text=${encodeURIComponent(message)}`;link.style.display="none";document.body.appendChild(link);link.click();document.body.removeChild(link);showNotification("ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ®ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠! ÿ≥ŸÜÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÉ ŸÇÿ±Ÿäÿ®ÿßŸã","success");closeCart();cart=[];updateCartBadge();const confirmationModal=document.getElementById("confirmation-modal");document.getElementById("order-number").textContent=orderCode;confirmationModal.style.display="block"})).catch((error=>{console.error("Error adding order:",error);showNotification("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®. ÿ®ÿ±ÿ¨ÿßÿ° ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ","error")}))}));function closeConfirmation(){const modal=document.getElementById("confirmation-modal");modal.style.display="none"}function showConfirmation(orderId){const modal=document.getElementById("confirmation-modal");document.getElementById("order-number").textContent=orderId;modal.style.display="block"}function showNotification(message,type="success"){const notification=document.getElementById("notification");const messageElement=document.getElementById("notification-message");messageElement.textContent=message;notification.className=`notification ${type}`;notification.classList.add("show");setTimeout((()=>{notification.classList.remove("show")}),3e3)}async function searchProducts(query){query=query.trim().toLowerCase();try{if(!query){const snapshot=await db.collection("products").get();const allProducts=[];snapshot.forEach((doc=>{allProducts.push({id:doc.id,...doc.data()})}));displayProducts(allProducts);return}const snapshot=await db.collection("products").orderBy("name").get();const filteredProducts=[];snapshot.forEach((doc=>{const product={id:doc.id,...doc.data()};if(product.name.toLowerCase().includes(query)||product.description?.toLowerCase().includes(query)){filteredProducts.push(product)}}));displayProducts(filteredProducts);if(filteredProducts.length===0){const menu=document.getElementById("menu");menu.innerHTML=`\n                <div class="no-results">\n                    <i class="fas fa-search"></i>\n                    <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ™ÿ∑ÿßÿ®ŸÇ ÿ®ÿ≠ÿ´ŸÉ</p>\n                </div>\n            `}}catch(error){console.error("ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ®ÿ≠ÿ´:",error);showNotification("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ®ÿ≠ÿ´. ÿ®ÿ±ÿ¨ÿßÿ° ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ","error")}}document.addEventListener("DOMContentLoaded",(function(){const loadingScreen=document.getElementById("loading-screen");setTimeout((()=>{loadingScreen.classList.add("fade-out");setTimeout((()=>{loadingScreen.style.display="none"}),500)}),2e3);loadProducts();document.querySelectorAll(".category-btn").forEach((button=>{button.addEventListener("click",(()=>{document.querySelectorAll(".category-btn").forEach((btn=>btn.classList.remove("active")));button.classList.add("active");currentCategory=button.dataset.category;displayProducts()}))}));const searchInput=document.getElementById("search-input");let searchTimeout;searchInput.addEventListener("input",(function(){clearTimeout(searchTimeout);searchTimeout=setTimeout((()=>{searchProducts(this.value)}),300)}));window.onclick=function(event){const cartModal=document.getElementById("cart-modal");const confirmationModal=document.getElementById("confirmation-modal");const priceModal=document.getElementById("price-modal");if(event.target===cartModal){closeCart()}if(event.target===confirmationModal){closeConfirmation()}if(event.target===priceModal){closePriceModal()}}}));window.addEventListener("beforeunload",(function(){const loadingScreen=document.getElementById("loading-screen");loadingScreen.style.display="flex";loadingScreen.classList.remove("fade-out")}));document.addEventListener("contextmenu",(function(e){e.preventDefault();return false}));document.addEventListener("keydown",(function(e){if(e.key==="F12"||e.ctrlKey&&e.shiftKey&&e.key==="I"||e.ctrlKey&&e.shiftKey&&e.key==="J"||e.ctrlKey&&e.key==="U"){e.preventDefault();return false}if(e.ctrlKey&&(e.key==="c"||e.key==="C")){e.preventDefault();return false}}));document.addEventListener("dragstart",(function(e){e.preventDefault();return false}));const observer=new MutationObserver((function(mutations){mutations.forEach((function(mutation){if(mutation.type==="childList"){const suspiciousElements=document.querySelectorAll('script[src*="http"], link[href*="http"]');suspiciousElements.forEach((element=>element.remove()))}}))}));observer.observe(document.body,{childList:true,subtree:true});setInterval((function(){if(window.outerWidth-window.innerWidth>160||window.outerHeight-window.innerHeight>160){document.body.innerHTML="ÿ™ŸÖ ÿßŸÉÿ™ÿ¥ÿßŸÅ ŸÖÿ≠ÿßŸàŸÑÿ© ÿßÿÆÿ™ÿ±ÿßŸÇ!"}const priceElements=document.querySelectorAll(".price");priceElements.forEach((element=>{const originalPrice=element.getAttribute("data-original-price");if(originalPrice&&element.textContent!==originalPrice){element.textContent=originalPrice}}))}),1e3);function encryptData(data){return btoa(JSON.stringify(data))}function validateSource(){const validDomains=["portozalabya.com","www.portozalabya.com"];if(!validDomains.includes(window.location.hostname)){document.body.innerHTML="Ÿáÿ∞ÿß ÿßŸÑŸÖŸàŸÇÿπ ŸÖÿ≤ŸäŸÅ!";return false}return true}async function sendOrder(orderData){if(!validateSource())return;const encryptedData=encryptData(orderData);try{const response=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json","X-Security-Token":generateSecurityToken()},body:JSON.stringify({data:encryptedData})});return await response.json()}catch(error){console.error("ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®");return null}}function generateSecurityToken(){const timestamp=Date.now();const random=Math.random().toString(36).substring(7);return btoa(`${timestamp}:${random}`)}